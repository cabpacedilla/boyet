 
<!-- 
This webpage will alert a message when added pomodoro breaktimes and back to work times is equal to the system time.
This code was assembled and written by Claive Alvin P. Acedilla. It can be copied, modified and redistributed.
November 2019
-->
		
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		
		<meta http-equiv="refresh" content="55">
		<meta http-equiv="Content-type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1">
		<title>Send Pomodoro alarm</title>
	</head>

	<body>
		<h1>Pomodoro work life balance</h1>

		<b>Enter a start time and stop time...</b>
		<p> Enter a start time in a 24-hour format like "8:00" for 8:00 AM: <input type="text" id="startTime" size="10" min="1" max="99">
		<p> Enter a stop time in a 24-hour format like "17:00" for 5:00 PM: <input type="text" id="stopTime" size="10" min="1" max="99">
		<br>
		<br>	
		<b>...then add your resume and break time intervals and the number of resume and break times.</b>	
		<p> Enter a break interval in minutes: <input type="number" id="breakInterval" size="1" min="1" max="99"> 
		<p> Enter a resume to work interval in minutes: <input type="number" id="backToWorkInterval" size="1" min="1" max="99">
		<p> Enter the number resume and break time intervals: <input type="number" id="repetition" size="1" min="1" max="99"> 
		<br>
		<br>
		<input type="button" value="Add break and resume intervals" onclick="addResumeBreakIntervals()">
		<br> 
		<br> 			
		<input type="button" value="Show break times" onclick="showBreakTimes()"> <input type="button" value="Show resume times" onclick="showResumeTimes()">
		<br> 
		<br> 
		<b> You may also add your break and resume to work times in a 12-hour "0:00 AM/PM" format like "8:20 AM".<br>
		Or you may also add multiple break and resume times in a 12-hour format separated by commas like "8:25 AM, 8:30 AM, 8:55 AM, 9:00 AM, 9:25 AM, 9:30 AM"...
		</b>
	
		<form>
			<p> Break time:
			<br> 
			<input type="text" id="pomodoroInputField" size="25"> 
			<input type="button" value="Add" onclick="addPomodoroTimes()">
			
			<p> Resume to work:
			<br> 
			<input type="text" id="backToWorkInputField" size="25">
			<input type="button" value="Add" onclick="addbackToWorkTimes()">
			<br> 
			<br>
			<input type="button" value="Show break times" onclick="showBreakTimes()"> <input type="button" value="Show resume times" onclick="showResumeTimes()">		
			<br>
			<br>
			<b> Delete an unneeded break time:</b>
			<p> Enter the number of nth break time that you want to delete starting from the top left in the break times list. <input type="button" value="Show break times" onclick="showBreakTimes()"><br>.
			<br>  
			<input type="number" id="breakTimeIndex" size="1" min="1" max="99">
			<input type="button" value="Delete" onclick="deletePomodoroTime()">
			<br>
			<br>
			<b> Delete an unneeded  resume time: </b>
			<p> Enter the number of nth resume time that you want to delete starting from the top left in the resume times list. <input type="button" value="Show resume times" onclick="showResumeTimes()"><br>.
			<br> 
			<input type="number" id="resumeTimeIndex" size="1" min="1" max="99">
			<input type="button" value="Delete" onclick="deleteBackToWorkTime()">
			<br> 
			<br> 
			<input type="button" value="Clear break times" onclick="clearBreakTimes()"> <input type="button" value="Clear resume times" onclick="clearResumeTimes()">
		
		</form>
	
		<script type="text/javascript">	
		
			var pomodoroArray = [];
			var backToWorkArray = [];
			var pomodoroTimes;
			var backToWorkTimes;
			var breakTimeString;
			var resumeTimeString;
			var alarmWindow;
			var breakAlertArray;
			var resumeAlertArray;
			var breakMessage;
			var resumeMessage;
			var currentTime;
			
			//Convert time to string in hour and minute.		
			currentTime = String(new Date().toLocaleTimeString("en-US", 
				{
					hour12 : true,
					hour : "numeric",
					minute : "numeric"
				}));	
			
			if (sessionStorage.getItem("pomodoroTimes") != null)
				{
					pomodoroArray = JSON.parse(sessionStorage.getItem("pomodoroTimes"));						
				}
			if (sessionStorage.getItem("backToWorkTimes") != null)
				{
					backToWorkArray = JSON.parse(sessionStorage.getItem("backToWorkTimes"));
				}	
			
			loopArray();
			
			function toTimeString(dateObj)
				{
					return dateObj.toLocaleTimeString("en-US", 
							{
							    hour12: true,
							     hour: "numeric",
							     minute: "numeric"
							 });
				}
			
			function addResumeBreakIntervals()				
				{				 				 				
					var resumeInterval = document.getElementById("backToWorkInterval").value;
					var resumeDuration = parseFloat(resumeInterval);
					var breakInterval = document.getElementById("breakInterval").value;
					var breakDuration = parseFloat(breakInterval);
					var ctr = document.getElementById("repetition").value;
					var repeat = parseFloat(ctr);
					var breakTime = new Date();
					var breakHours = breakTime.getHours();
					var breakMinutes = breakTime.getMinutes();
					var resumeTime = new Date();
					var resumeHours = resumeTime.getHours();
					var resumeMinutes = resumeTime.getMinutes();
					var startTime;
					var startTimeObject = new Date();
					var stopTime;
					var stopTimeObject = new Date();
					
					
					if (resumeInterval == "" || breakInterval == "")
						{
							alert("Please enter a break time, resume time and the number intervals.");
							return;
						}
					
					startTime = document.getElementById("startTime").value;
					stopTime = document.getElementById("stopTime").value;
					
					if (startTime != "" && stopTime != "")
						{
							startTime = startTime.substring(0, 4);
							startTime = startTime.split(":");	
							startTimeObject.setHours(startTime[0], startTime[1]);
							breakMinutes = startTimeObject.getMinutes();
							breakHours = startTimeObject.getHours();
							breakTime.setHours(breakHours, breakMinutes);
							resumeHours = startTimeObject.getHours();
							resumeMinutes = startTimeObject.getMinutes();
							resumeTime.setHours(resumeHours, resumeMinutes);
							//alert(resumeMinutes);
							
							stopTime = stopTime.substring(0, 4);
							stopTime = stopTime.split(":");	
							stopTimeObject.setHours(stopTime[0], stopTime[1]);
						}
					
					
					while (breakTime < stopTimeObject && resumeTime < stopTimeObject)
						{
							breakMinutes = resumeMinutes + breakDuration;
							/* if (breakMinutes == 0)
							{
								breakMinutes = resumeMinutes + breakDuration;					
							}	 */						
							breakTime.setHours(breakHours, breakMinutes);
			
							resumeMinutes  = breakMinutes + resumeDuration;	
							resumeTime.setHours(resumeHours, resumeMinutes);
							
							breakTimeString = toTimeString(breakTime);
							pomodoroTimes = breakTimeString;
							pomodoroArray.push(pomodoroTimes);
							
							resumeTimeString = toTimeString(resumeTime);
							backToWorkTimes = resumeTimeString;
							backToWorkArray.push(backToWorkTimes);	
						}
					
					if (ctr != "")
					{
						while (repeat != 0)
						{
							breakMinutes = resumeMinutes + breakDuration;
							/* if (breakMinutes == 0)
							{
								breakMinutes = resumeMinutes + breakDuration;					
							}	 */						
							breakTime.setHours(breakHours, breakMinutes);
							
							breakHours = breakTime.getHours();
							resumeHours = resumeTime.getHours();
			
							resumeMinutes  = breakMinutes + resumeDuration;	
							resumeTime.setHours(resumeHours, resumeMinutes);							
							
							breakTimeString = toTimeString(breakTime);
							pomodoroTimes = breakTimeString;
							pomodoroArray.push(pomodoroTimes);
							
							resumeTimeString = toTimeString(resumeTime);
							backToWorkTimes = resumeTimeString;
							backToWorkArray.push(backToWorkTimes);	
						
							repeat = repeat - 1;
						}
					}
					
					sessionStorage.setItem("pomodoroTimes", JSON.stringify(pomodoroArray));
					sessionStorage.setItem("backToWorkTimes", JSON.stringify(backToWorkArray));
					alert("Break and resume time intervals were added.");
				}
			
			function addPomodoroTimes() 
				{
					pomodoroTimes = document.getElementById("pomodoroInputField").value;
					if (pomodoroTimes == "") 
						{
							alert("Please enter a break time in 0:00 AM or PM format.");
						} 
					else 
						{
							pomodoroArray.push(pomodoroTimes);		
							sessionStorage.setItem("pomodoroTimes", JSON.stringify(pomodoroArray));
							alert("Break time was added.");
						}				
				}
			function addbackToWorkTimes() 
				{
					backToWorkTimes = document.getElementById("backToWorkInputField").value;
					if (backToWorkTimes == "") 
						{
							alert("Please enter a break time in 0:00 AM or PM format.");
						} 
					else 
						{
							backToWorkArray.push(backToWorkTimes);
							sessionStorage.setItem("backToWorkTimes", JSON.stringify(backToWorkArray));	
							alert("Resume time was added.");
						}							
				}
								
			function showBreakTimes() 
				{
					if (pomodoroArray.length == 0)
						{
							alert("Break times is empty. Please add break times.");
						}
					else
						{
							alert(pomodoroArray);
						}
					
				}
			function showResumeTimes() 
				{
					if (backToWorkArray.length == 0)
						{
							alert("Resume times is empty. Please add resume times");
						}
					else
						{
							alert(backToWorkArray);
						}
					
				}
			
			function deletePomodoroTime()
				{
					var ctr = document.getElementById("breakTimeIndex").value;
					
					if (pomodoroArray.length == 0)
						{
							alert("Break times is empty");
						}
					
					if (ctr == "")
						{
							alert("Enter the number of nth resume time starting from the top left in the resume times list.");
						}
					else
						{
							var index = parseFloat(ctr);
							pomodoroArray.splice(index - 1, 1);					
							alert("Break time was cleared.");
						}					
				}
			
			function deleteBackToWorkTime()
				{
					var ctr = document.getElementById("resumeTimeIndex").value;
					
					if (backToWorkArray.length == 0)
						{
							alert("Break times is empty");
						}
					
					if (ctr == "")
						{
							alert("Enter the number of nth resume time starting from the top left in the resume times list.");
						}
					else
						{
							var index = parseFloat(ctr);
							backToWorkArray.splice(index - 1, 1);					
							alert("Resume time was cleared.");
						}					
				}
			
			function clearBreakTimes()
				{
					while (pomodoroArray.length)
						{
							while (pomodoroArray.length > 0)
								{
									sessionStorage.removeItem("pomodoroTimes");
									sessionStorage.removeItem("breakTimeString");
									pomodoroArray = [];
								}
							
							alert("Break times were cleared.");	
							return;
						}
					
					if (pomodoroArray.length == 0)
						{
							alert("Break times is empty. Please add resume times.")
						}				
				}
			
			function clearResumeTimes()
				{
					while (backToWorkArray.length)
						{
							while (backToWorkArray.length > 0)
								{
									sessionStorage.removeItem("backToWorkTimes");
									sessionStorage.removeItem("resumeTimeString");
									backToWorkArray = [];
								}
							
							alert("Resume times were cleared.");
							return;
						}
					
					if (backToWorkArray.length == 0)
						{
							alert("Resume times is empty. Please add resume times.")
						}
				}
			
			function loopArray() 
				{						
					var ctr = 0;
		
					//Loop the arrays while pomodoroArray is not equal to currentTime or backToWorkArray is not equal to currentTime
					while (pomodoroArray[ctr] != currentTime || backToWorkArray[ctr] != currentTime) 
						
						{							
							
							// If pomodoro time is equal to current time, alarm for pomodoro with pop-up message
							if (pomodoroArray[ctr] == currentTime) 
								{
									alarmWindow = window.open("", "BreakTime", "width=350,height=50");
									alarmWindow.focus();
									breakAlertArray = pomodoroArray[ctr] + " ." + "</p>";
									breakMessage = "<p>Time for a break because it is now ";
									alarmWindow.document.write(breakMessage + breakAlertArray);
									setTimeout(function(){ alarmWindow.close(); }, 50000);
									break;
								}
							
							// If back to work time is equal to current time, alarm for back to work with pop-up message    			
							if (backToWorkArray[ctr] == currentTime) 
								{
									alarmWindow = window.open("", "ResumeToWork", "width=375,height=50");
									alarmWindow.focus();
									resumeAlertArray = backToWorkArray[ctr] + " ." + "</p>";
									resumeMessage = "<p>Time to resume to work because it is now ";
									alarmWindow.document.write(resumeMessage + resumeAlertArray);
									setTimeout(function(){ alarmWindow.close(); }, 50000);
									break;
								}
			
							//break from the ctr if the iteration reach the last elements of the pomodoro and back to work time arrays
							if (pomodoroArray[ctr] == pomodoroArray[pomodoroArray.length] && backToWorkArray[ctr] == backToWorkArray[backToWorkArray.length]) 
								{
									break;
								}
			
							//increment ctr count
							ctr = ctr + 1;
						}
				}
		</script>
	</body>
</html>

